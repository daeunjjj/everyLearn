<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="adminMapper">
	
	<resultMap type="com.coding5.el.member.vo.MemberVo" id="memberMap">
		<result property="memberNo" column="NO"/>
		<result property="memberId" column="ID"/>
		<result property="memberPwd" column="PWD"/>
		<result property="memberName" column="NAME"/>
		<result property="memberNick" column="NICK"/>
	</resultMap>
	
	
	<select id="selectOneAdminByVo" resultType="AdminVo">
		SELECT 
		    A.NO
		    ,PER.NAME AS PERMISSION
		    ,PO.NAME AS POSITION
		    ,A.ID
		    ,A.PWD
		    ,A.NICK
		    ,A.NAME
		    ,A.PHONE
		    ,A.ENROLL_DATE
		    ,A.MODIFY_DATE
		    ,A.QUIT_YN
		    ,A.PROFILE_NAME
		FROM ADMIN A
		JOIN ADMIN_PERMISSION PER 
		    ON A.PERMISSION = PER.NO
		JOIN ADMIN_POSITION PO 
		    ON A.POSITION = PO.NO
		<where>
			<if test="id != null and id != ''">
			 	A.ID = #{id}			
			</if>    
			<if test="nick != null and nick != ''">
				AND A.NICK = #{nick}
			</if>
		</where>
	</select>
	
	<insert id="insertAdminOne">
		INSERT INTO ADMIN
		(
		    NO
		    , PERMISSION
		    , POSITION
		    , ID
		    , PWD
		    , NICK
		    , NAME
		    , PHONE
		)
		VALUES
		(
		    SEQ_ADMIN_NO.NEXTVAL
		    , #{permission}
		    , #{position}
		    , #{id}
		    , #{pwd}
		    , #{nick}
		    , #{name}
		    , #{phone}
		)
	</insert>
	
	<update id="updateAdmin">
		UPDATE ADMIN
		    SET
	    <if test="nick != null and nick != ''">
		    NICK = #{nick}	    
	    </if>
	    <if test="phone != null and phone != ''">
		    ,PHONE = #{phone}	    
	    </if>
	  	<if test="pwd != null and pwd != ''">
		    ,PWD = #{pwd}
	    </if>
		<if test="position != null and position != ''">
			,POSITION = #{position}
		</if>
		<if test="permission != null and permission != ''">
			,PERMISSION = #{permission}
		</if>
		<if test="profileName != null and profileName != ''">
			,PROFILE_NAME = #{profileName}
		</if>
		WHERE NO = #{no}
	</update>
	
	<select id="selectAdminConut" resultType="int">
		SELECT COUNT(*)
		FROM ADMIN
		<if test="keyword != null and keyword != ''">
			WHERE ${category} LIKE '%${keyword}%'
		</if>
	</select>
	
	<select id="selectAdminList" resultType="AdminVo">
		SELECT 
		    A.NO
		    ,PER.NAME AS PERMISSION
		    ,PO.NAME AS POSITION
		    ,A.ID
		    ,A.PWD
		    ,A.NICK
		    ,A.NAME
		    ,A.PHONE
		    ,A.ENROLL_DATE
		    ,A.MODIFY_DATE
		    ,DECODE(QUIT_YN, 'N','유지', 'Y','탈퇴') AS QUIT_YN
		FROM ADMIN A
		JOIN ADMIN_PERMISSION PER 
		    ON A.PERMISSION = PER.NO
		JOIN ADMIN_POSITION PO 
		    ON A.POSITION = PO.NO
    	<if test="keyword != null and keyword != ''">
	    	WHERE A.${category} LIKE '%${keyword}%'
    	</if>
	    ORDER BY A.ENROLL_DATE DESC
	</select>
	
	<select id="selectOneAdminByNo" resultType="AdminVo">
		SELECT 
		    NO
		    ,PERMISSION
		    ,POSITION
		    ,ID
		    ,NICK
		    ,NAME
		    ,PHONE
		    ,ENROLL_DATE
		    ,MODIFY_DATE
		    ,QUIT_YN
		    ,PROFILE_NAME
		FROM ADMIN
   		WHERE NO = #{no}
	</select>
	
	<select id="selectOneAdminById" resultType="AdminVo">
		SELECT 
		    A.NO
		    ,PER.NAME AS PERMISSION
		    ,PO.NAME AS POSITION
		    ,A.ID
		    ,A.PWD
		    ,A.NICK
		    ,A.NAME
		    ,A.PHONE
		    ,A.ENROLL_DATE
		    ,A.MODIFY_DATE
		    ,A.QUIT_YN
		    ,A.PROFILE_NAME
		FROM ADMIN A
		JOIN ADMIN_PERMISSION PER 
		    ON A.PERMISSION = PER.NO
		JOIN ADMIN_POSITION PO 
		    ON A.POSITION = PO.NO
   		WHERE A.ID = #{id}
   		AND A.QUIT_YN = 'N'
	</select>
	
	<select id="selectStudentCount" resultType="int">
		SELECT COUNT(*)
		FROM MEMBER
		<if test="keyword != null and keyword != ''">
			WHERE ${category} LIKE '%${keyword}%'
		</if>
	</select>
	
	<select id="selectStudentList" resultType="com.coding5.el.member.vo.MemberVo" resultMap="memberMap">
		SELECT 
		    NO
		    ,ID
		    ,PWD
		    ,NAME
		    ,BIRTH
		    ,PHONE
		    ,NICK
		    ,EMAIL
		    ,TO_CHAR(ENROLL_DATE, 'YYYY-MM-DD') AS ENROLL_DATE
		    ,MODIFY_DATE
		    ,PROFILE_IMG
		    ,POINT
		    ,REPORT_YN
		    ,QUIT_YN
		FROM MEMBER
		<if test="keyword != null and keyword != ''">
			WHERE ${category} LIKE '%${keyword}%'
		</if>
	</select>
	
	<select id="selectStudentOneByNo" resultType="com.coding5.el.member.vo.MemberVo" resultMap="memberMap">
		SELECT
		    NO
		    ,ID
		    ,PWD
		    ,NAME
		    ,TO_CHAR(BIRTH, 'YYYY-MM-DD') AS BIRTH
		    ,PHONE
		    ,NICK
		    ,EMAIL
		    ,ENROLL_DATE
		    ,MODIFY_DATE
		    ,PROFILE_IMG
		    ,POINT
		    ,DECODE(REPORT_YN, 'N','활동', 'Y','정지') AS REPORT_YN
		    ,DECODE(QUIT_YN, 'N','유지', 'Y','탈퇴') AS QUIT_YN
		FROM MEMBER
		WHERE NO = #{memberNo}
	</select>
	<select id="selectPointListByNo" resultType="com.coding5.el.member.vo.PointVo">
		SELECT
		    P.MEMBER_NO
		    ,CP.NAME AS HISTORY
		    ,P.CHANGE
		    ,P.ENROLL_DATE
		FROM POINT P
		JOIN CATE_POINT CP ON P.HISTORY = CP.NO
		WHERE P.MEMBER_NO = #{memberNo}
		ORDER BY P.ENROLL_DATE DESC
	</select>
	<insert id="insertPoint">
		INSERT INTO POINT 
		(
			MEMBER_NO
			, HISTORY
			, CHANGE
		) 
		VALUES
		(
			#{memberNo}
			, #{history}
			, #{change}
		)
	</insert>
	
	<update id="updateStudent">
		UPDATE MEMBER 
			SET 
		POINT = POINT ${change} WHERE NO = #{memberNo}
	</update>
	
	<select id="selectTeacherCount" resultType="int">
			SELECT COUNT(*)
			FROM TEACHER T
			JOIN MEMBER M ON T.MEMBER_NO = M.NO
		<where>
			<if test="keyword != null and keyword != ''">
				M.${category} LIKE '%${keyword}%'
			</if>
			<if test="category == 'status'">
				AND T.STATUS_YN = 'N'
			</if>
		</where>
		<if test="cate != null and keyword != ''">
			AND T.CATEGORY IN
			<foreach collection="cate" item="arr" open="(" close=")" separator=",">
			#{arr}
			</foreach>
		</if>
	</select>
	
	<select id="selectTeacherList" resultType="com.coding5.el.teacher.vo.TeacherVo">
		SELECT
		    T.NO
		    ,T.MEMBER_NO
		    ,T.CATEGORY AS CLASS_CATE
		    ,T.CAREER
		    ,T.SHORT_INTRO
		    ,T.INTRODUCE
		    ,T.RECORD
		    ,T.ENROLL_DATE
		    ,T.MODIFY_DATE
		    ,T.STATUS_YN
		    ,T.DELETE_YN
		    ,M.ID
		    ,M.EMAIL
		    ,M.NAME
   			,M.PHONE
		FROM TEACHER T
		JOIN MEMBER M ON T.MEMBER_NO = M.NO
		<where>
			<if test="keyword != null and keyword != ''">
				M.${category} LIKE '%${keyword}%'
			</if>
			<if test="category == 'status'">
				T.STATUS_YN = 'N'
			</if>
			<if test="cate != null and keyword != ''">
				AND T.CATEGORY IN
				<foreach collection="cate" item="arr" open="(" close=")" separator=",">
				#{arr}
				</foreach>
			</if>
		</where>	
		ORDER BY T.NO DESC
	</select>
	
	<select id="selectTeacherStatusByN" resultType="int">
		SELECT COUNT(*)
		FROM TEACHER
		WHERE STATUS_YN = 'N'
		AND DELETE_YN = 'N'
	</select>
	
	<select id="selectTeacherDetailByNo" resultType="com.coding5.el.teacher.vo.TeacherVo">
		SELECT
		    T.NO
		    ,T.MEMBER_NO
		    ,T.CATEGORY AS CLASS_CATE
		    ,T.CAREER
		    ,T.SHORT_INTRO
		    ,T.INTRODUCE
		    ,T.RECORD AS CHANGE_NAME2
		    ,T.ENROLL_DATE
		    ,T.MODIFY_DATE
		    ,T.STATUS_YN
		    ,T.DELETE_YN
		    ,M.ID
		    ,M.EMAIL
		    ,M.NAME
		    ,P.CHANGE_NAME
		    ,M.PHONE
		FROM TEACHER T
		JOIN MEMBER M 
		ON T.MEMBER_NO = M.NO
		JOIN PROFILE_TEACHER_ATTATCH P ON T.NO = P.TEACHER_NO
		WHERE T.NO = #{no}
	</select>
	
	<select id="selectLectureList" resultType="com.coding5.el.lecture.vo.LectureVo">
		SELECT
			NO
			,TEACHER_NO
			,CATEGORY
			,CLASS_NAME
			,CLASS_CONTENT
			,RECOMM
			,STUDENT_CNT
			,PRICE
			,ENROLL_DATE
			,TO_CHAR(MODIFY_DATE, 'YYYY-MM-DD') AS MODIFY_DATE
			,DELETE_YN
			,CLASS_CNT
		FROM CLASS
		WHERE TEACHER_NO = #{no}
	</select>
	
	<update id="teacherDeleteByNo">
		UPDATE TEACHER
		SET 
		    STATUS_YN = 'N'
		  , DELETE_YN = 'Y'
		WHERE NO IN
		<foreach collection="array" item="no" open="(" close=")" separator=",">
			#{no}
		</foreach>
	</update>
	<update id="teacherApprovalByNo">
		UPDATE TEACHER
		SET 
		    STATUS_YN = 'Y'
		WHERE NO = #{no}
	</update>
	
	<update id="classDeleteByNo">
		UPDATE CLASS
		SET 
		    DELETE_YN = 'Y'
		WHERE NO = #{cno}
	</update>
	
	<select id="selectAdminIdListByPhone" resultType="AdminVo">
		SELECT 
		    ID 
		  , TO_CHAR(ENROLL_DATE, 'YYYY-MM-DD') AS ENROLL_DATE
		FROM ADMIN 
		WHERE QUIT_YN = 'N'
		AND PHONE = #{phone}
	</select>
	
	<update id="updateAdminQuityByNo">
		UPDATE ADMIN
		    SET QUIT_YN = 'Y'
		WHERE NO = #{no}
	</update>
	
	<select id="selectCorporateCount" resultType="int">
		SELECT COUNT(*)
		FROM CORPORATE_MEMBER
		<if test="keyword != null and keyword != ''">
			WHERE ${category} LIKE '%${keyword}%'
		</if>
		<if test="cate != null and keyword != ''">
			AND SECTOR IN
			<foreach collection="cate" item="arr" open="(" close=")" separator=",">
			#{arr}
			</foreach>
		</if>
	</select>
	
	<select id="selectCorporateList" resultType="CorpVo">
		SELECT 
		    NO
		    ,ID
		    ,PWD
		    ,COMPANY_NAME
		    ,COMPANY_ADDRESS
		    ,DETAIL_ADDRESS
		    ,NAME
		    ,PHONE
		    ,INTRODUCE
		    ,ENROLL_DATE
		    ,MODIFY_DATE
		    ,COMPANY_NUM
		    ,QUIT_YN
		    ,STATUS_YN
		    ,SECTOR
		    ,EMP_NUM
		    ,SALES
		    ,HOMEPAGE
		    ,DELETE_YN
		FROM CORPORATE_MEMBER
		<where>
			<if test="keyword != null and keyword != ''">
				${category} LIKE '%${keyword}%'
			</if>
			<if test="cate != null and keyword != ''">
				AND SECTOR IN
				<foreach collection="cate" item="arr" open="(" close=")" separator=",">
				#{arr}
				</foreach>
			</if>
		</where>	
		ORDER BY NO DESC
	</select>
	<select id="selectCorporateStatusByN" resultType="int">
		SELECT COUNT(*)
		FROM CORPORATE_MEMBER
		WHERE STATUS_YN = 'N'
		AND DELETE_YN = 'N'
	</select>
	
	<select id="selectCorpDetailByNo" resultType="CorpVo">
		SELECT 
		    NO
		    ,ID
		    ,PWD
		    ,COMPANY_NAME
		    ,COMPANY_ADDRESS
		    ,DETAIL_ADDRESS
		    ,NAME
		    ,PHONE
		    ,INTRODUCE
		    ,ENROLL_DATE
		    ,MODIFY_DATE
		    ,COMPANY_NUM
		    ,QUIT_YN
		    ,STATUS_YN
		    ,SECTOR
		    ,EMP_NUM
		    ,SALES
		    ,HOMEPAGE
		    ,DELETE_YN
		FROM CORPORATE_MEMBER
		WHERE NO = #{no}
	</select>
	
	<select id="selectEmploymentList" resultType="EmploymentVo">
		SELECT
		    E.NO
		    ,E.CORP_NO
		    ,C.TYPE AS CATEGORY
		    ,E.TITLE
		    ,E.RESPONSIBILITY
		    ,E.QUALIFICATION
		    ,E.PREFERENTIAL
		    ,E.SALARY
		    ,E.BENEFITS
		    ,E.INTRODUCE
		    ,E.SECTOR
		    ,E.ADDRESS
		    ,E.CAREER
		    ,E.DEADLINE
		    ,E.WISH_CNT
		    ,E.ENROLL_DATE
		    ,TO_CHAR(MODIFY_DATE, 'YYYY-MM-DD') AS MODIFY_DATE
		    ,E.DELETE_YN
		FROM EMPLOYMENT E
		JOIN EMP_CATE C ON E.CATEGORY = C.NO
		WHERE CORP_NO = #{no}
	</select>
	
	<update id="studentQuit">
		UPDATE MEMBER
		SET QUIT_YN = 'Y'
		WHERE NO IN 
		<foreach collection="array" item="no" open="(" close=")" separator=",">
			#{no}
		</foreach>
	</update>
	<update id="corporateQuit">
		UPDATE CORPORATE_MEMBER
		SET QUIT_YN = 'Y'
		WHERE NO IN 
		<foreach collection="array" item="no" open="(" close=")" separator=",">
			#{no}
		</foreach>
	</update>
	<update id="empBoardDelete">
		UPDATE EMPLOYMENT
		SET DELETE_YN = 'Y'
		WHERE NO = #{eno}
	</update>
	
	<update id="corporateDelete">
		UPDATE CORPORATE_MEMBER
		SET DELETE_YN = 'Y'
		WHERE NO = #{no}
	</update>
	
	<update id="corporateApproval">
		UPDATE CORPORATE_MEMBER
		SET STATUS_YN = 'Y'
		WHERE NO = #{no}
	</update>
</mapper>
